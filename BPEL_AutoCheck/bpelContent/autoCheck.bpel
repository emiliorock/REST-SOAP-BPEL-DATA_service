<!-- autoCheck BPEL Process [Generated by the Eclipse BPEL Designer] -->
<!-- Date: Tue May 24 20:09:36 AEST 2016 -->
<bpel:process name="autoCheck" targetNamespace="http://autoCheck"
	suppressJoinFailure="yes" xmlns:tns="http://autoCheck"
	xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
	xmlns:DLValidation="http://soacourse.unsw.edu.au/dlvalidator"
	xmlns:ADRValidation="http://soacourse.unsw.edu.au/adrvalidator"
	xmlns:xsd="http://www.w3.org/2001/XMLSchema" exitOnStandardFault="yes"
	xmlns:xsd1="http://soacourse.unsw.edu.au/dldefinitions" xmlns:xsd2="http://soacourse.unsw.edu.au/adrdefinitions">

	<!-- Import the client WSDL -->
	<bpel:import location="autoCheckArtifacts.wsdl" namespace="http://autoCheck"
		importType="http://schemas.xmlsoap.org/wsdl/" />
	<bpel:import namespace="http://soacourse.unsw.edu.au/dlvalidator"
		importType="http://schemas.xmlsoap.org/wsdl/" location="dlvalidator.wsdl" />
	<bpel:import namespace="http://soacourse.unsw.edu.au/adrvalidator"
		importType="http://schemas.xmlsoap.org/wsdl/" location="adrvalidator.wsdl" />


	<!-- ================================================================= -->
	<!-- PARTNERLINKS -->
	<!-- List of services participating in this BPEL process -->
	<!-- ================================================================= -->
	<bpel:partnerLinks>
		<!-- The 'client' role represents the requester of this service. -->
		<bpel:partnerLink name="client" partnerLinkType="tns:autoCheck"
			myRole="autoCheckProvider" />
		<bpel:partnerLink name="dlvalidator" partnerLinkType="tns:dlcheckLinkType"
			partnerRole="dlValidator" />
		<bpel:partnerLink name="adrvalidator"
			partnerLinkType="tns:adrcheckLinkType" partnerRole="adrValidator" />
	</bpel:partnerLinks>

	<!-- ================================================================= -->
	<!-- VARIABLES -->
	<!-- List of messages and XML documents used within this BPEL process -->
	<!-- ================================================================= -->

	<bpel:variables>
		<bpel:variable name="input" messageType="tns:autoCheckRequestMessage" />
		<bpel:variable name="dlRequest" messageType="DLValidation:validate" />
		<bpel:variable name="adrRequest" messageType="ADRValidation:validate" />
		<bpel:variable name="dlResponse" messageType="DLValidation:validateResponse" />
		<bpel:variable name="adrResponse" messageType="ADRValidation:validateResponse" />
		<bpel:variable name="output" messageType="tns:autoCheckResponseMessage" />
		<bpel:variable name="dlcp" type="xsd:string" />
	</bpel:variables>

	<!-- ================================================================= -->
	<!-- ORCHESTRATION LOGIC -->
	<!-- Set of activities coordinating the flow of messages across the -->
	<!-- services integrated within this business process -->
	<!-- ================================================================= -->
	<bpel:sequence name="main">

		<!-- Receive input from requester. Note: This maps to operation defined 
			in autoCheck.wsdl -->
		<bpel:receive name="receiveInput" partnerLink="client"
			portType="tns:autoCheck" operation="process" variable="input"
			createInstance="yes" />

		<!-- Generate reply to synchronous request -->
 
        
        <bpel:assign validate="no" name="Assign">
            
            
            <bpel:copy>
                <bpel:from part="autoRequest" variable="input">
                    <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:dl]]></bpel:query>
                </bpel:from>
                <bpel:to variable="dlcp"></bpel:to>
            </bpel:copy>
        </bpel:assign>
        <bpel:if name="DlProvided">
            <bpel:condition expressionLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[string($dlcp)!=string("")]]></bpel:condition>
            <bpel:sequence name="CheckDL"><bpel:assign validate="no" name="AssignDL">
                        <bpel:copy>
                            <bpel:from><bpel:literal><tns:DLInfoMessage xmlns:tns="http://soacourse.unsw.edu.au/dldefinitions" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:fullName>tns:fullName</tns:fullName>
  <tns:dl>tns:dl</tns:dl>
</tns:DLInfoMessage>
</bpel:literal></bpel:from>
                            <bpel:to variable="dlRequest" part="dlreq"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="autoRequest" variable="input">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:fullName]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="dlreq" variable="dlRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[xsd1:fullName]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                        
                        <bpel:copy>
                            <bpel:from part="autoRequest" variable="input">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:dl]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="dlreq" variable="dlRequest">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[xsd1:dl]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                    <bpel:invoke name="InvokeDL" partnerLink="dlvalidator" operation="validate" portType="DLValidation:DLValidationPT" inputVariable="dlRequest" outputVariable="dlResponse"></bpel:invoke>
                    <bpel:assign validate="no" name="AssignDLRes">
                        <bpel:copy>
                            <bpel:from><bpel:literal><tns:autoCheckResponse xmlns:tns="http://autoCheck" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:output>tns:output</tns:output>
</tns:autoCheckResponse>
</bpel:literal></bpel:from>
                            <bpel:to variable="output" part="autoResponse"></bpel:to>
                        </bpel:copy>
                        <bpel:copy>
                            <bpel:from part="dlresp" variable="dlResponse">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[xsd1:accept]]></bpel:query>
                            </bpel:from>
                            <bpel:to part="autoResponse" variable="output">
                                <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:output]]></bpel:query>
                            </bpel:to>
                        </bpel:copy>
                    </bpel:assign>
                
            </bpel:sequence>
            <bpel:else>
                <bpel:sequence name="CheckADR">
                <bpel:assign validate="no" name="AssignADR">
                    <bpel:copy>
                        <bpel:from><bpel:literal><tns:ADRInfoMessage xmlns:tns="http://soacourse.unsw.edu.au/adrdefinitions" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:fullName>tns:fullName</tns:fullName>
  <tns:adr>tns:adr</tns:adr>
</tns:ADRInfoMessage>
</bpel:literal></bpel:from>
                        <bpel:to variable="adrRequest" part="adrreq"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="autoRequest" variable="input">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:fullName]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="adrreq" variable="adrRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[xsd2:fullName]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="autoRequest" variable="input">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:address]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="adrreq" variable="adrRequest">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[xsd2:adr]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                </bpel:assign>
                <bpel:invoke name="InvokeADR" partnerLink="adrvalidator" operation="validate" portType="ADRValidation:ADRValidationPT" inputVariable="adrRequest" outputVariable="adrResponse"></bpel:invoke>
                <bpel:assign validate="no" name="AssignADRRes">
                    <bpel:copy>
                        <bpel:from><bpel:literal><tns:autoCheckResponse xmlns:tns="http://autoCheck" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <tns:output>tns:output</tns:output>
</tns:autoCheckResponse>
</bpel:literal></bpel:from>
                        <bpel:to variable="output" part="autoResponse"></bpel:to>
                    </bpel:copy>
                    <bpel:copy>
                        <bpel:from part="adrresp" variable="adrResponse">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[xsd2:accept]]></bpel:query>
                        </bpel:from>
                        <bpel:to part="autoResponse" variable="output">
                            <bpel:query queryLanguage="urn:oasis:names:tc:wsbpel:2.0:sublang:xpath1.0"><![CDATA[tns:output]]></bpel:query>
                        </bpel:to>
                    </bpel:copy>
                </bpel:assign>
            </bpel:sequence>
            </bpel:else>
        </bpel:if>
        
        <bpel:reply name="replyOutput" 
               partnerLink="client"
               portType="tns:autoCheck"
               operation="process" 
               variable="output"
               />
    </bpel:sequence>
</bpel:process>

